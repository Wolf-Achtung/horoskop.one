<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>horoskop.one – Dein achtsamer Horoskop-Kompass</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="light only" />
  <style>
    :root { --bg:#f5f3fa; --bg-card:#ffffff; --ink:#2c2541; --pri:#5b3e9e; --pri-2:#37205d; --card-bd:#ece3ff; --chip-bd:#e6d8ff; }
    *{box-sizing:border-box} body{font-family:Inter,system-ui,Arial,sans-serif;margin:0;background:linear-gradient(180deg,var(--bg),#e7e2f2);color:var(--ink)}
    header{background:linear-gradient(135deg,var(--pri),var(--pri-2));color:#fff;padding:24px 14px;text-align:center}
    header .topnav{display:flex;gap:12px;justify-content:center;margin-top:8px}
    header .topnav a{color:#e7defc;font-size:14px;text-decoration:none} header .topnav a:hover{text-decoration:underline}
    main{max-width:950px;margin:20px auto;padding:16px;background:#fff;border-radius:14px;box-shadow:0 8px 20px rgba(0,0,0,.12)}
    h2{margin:0 0 8px} label{display:block;margin:10px 0 6px;font-weight:700}
    input[type="text"],input[type="date"],input[type="time"],select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #cfc7e6;background:#fbfaff;font-size:16px}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:none;background:var(--pri);color:#fff;font-size:16px;cursor:pointer}
    .btn.secondary{background:#efe8ff;color:#2c2541;border:1px solid #ded5ff} .btn:hover{opacity:.95} .btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .badge{display:inline-block;padding:4px 8px;border:1px solid var(--chip-bd);border-radius:999px;font-size:12px;margin:2px 6px 2px 0;background:#f8f4ff}
    .result{margin-top:12px} .reading-card{background:#faf7ff;border-radius:12px;padding:16px;margin:12px 0;border:1px solid var(--card-bd)}
    .hl{display:flex;gap:10px;padding:10px 12px;border:1px solid #efe8ff;border-radius:12px;margin:6px 0}
    .why{margin-top:6px} .why .badge{background:#fff;border-color:#e9e9f2;color:#555}
    details.reading{border:1px solid #efe8ff;border-radius:12px;margin:10px 0;background:#fdfbff}
    details.reading summary{cursor:pointer;padding:10px 12px;font-weight:700;list-style:none}
    details.reading summary::-webkit-details-marker{display:none}
    .meta{font-size:12px;color:#6b6280;margin-top:6px} .status{margin-top:6px;color:#555;font-size:14px}
    .disclaimer{font-size:13px;color:#666;margin-top:16px;text-align:center}
  </style>
  <script>tailwind={};tailwind.config={corePlugins:{preflight:false}};</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <header>
    <div><strong>horoskop.one</strong> – achtsam & erklärbar</div>
    <div class="topnav">
      <a href="methoden.html">Methoden</a>
      <a href="impressum.html">Impressum</a>
      <a href="datenschutz.html">Datenschutz</a>
    </div>
  </header>
  <main>
    <button id="toggle-mixer" class="badge" style="border:none;background:#fff;margin-bottom:8px">Erweiterte Einstellungen ▾</button>
    <section id="mixerSection" class="rounded-2xl" style="margin:0 0 1rem 0;display:none">
      <h2>Kosmischer Mixer</h2><div id="mixer-root"></div>
    </section>

    <section id="birthInfo">
      <h2>Deine Geburtsdaten</h2>
      <p class="meta">Datum & Ort genügen. Falls keine exakte Uhrzeit: „Morgens / Mittags / Abends / Nachts“ wählen.</p>

      <label for="birthDate">Geburtsdatum</label>
      <input type="date" id="birthDate" />

      <label for="birthPlace">Geburtsort</label>
      <input type="text" id="birthPlace" placeholder="z. B. Berlin" />

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div>
          <label for="birthTime">Geburtszeit (optional)</label>
          <input type="time" id="birthTime" placeholder="--:--" />
        </div>
        <div>
          <label for="timeApprox">…oder ungefähr</label>
          <select id="timeApprox">
            <option value="">Unbekannt</option>
            <option value="morning">Morgens (05–11 Uhr)</option>
            <option value="noon">Mittags (11–15 Uhr)</option>
            <option value="evening">Abends (15–22 Uhr)</option>
            <option value="night">Nachts (22–05 Uhr)</option>
          </select>
        </div>
      </div>

      <label for="partnerDate">Zweites Geburtsdatum (optional)</label>
      <input type="date" id="partnerDate" />

      <label for="timeFrame">Vorhersagezeitraum</label>
      <select id="timeFrame">
        <option value="morgen">Morgen</option>
        <option value="woche">Nächste Woche</option>
        <option value="monat">Nächster Monat</option>
        <option value="restjahr">Restliches Jahr</option>
        <option value="jahr">Nächstes Jahr</option>
      </select>

      <div class="btnrow">
        <button class="btn secondary" onclick="generateAnalysis()">Sofort-Analyse (offline)</button>
        <button class="btn" onclick="generateAiReading()">Gold-Reading (AI)</button>
      </div>

      <div class="meta">Erklärbar (Why-Chips) · Reproduzierbar (Seed) · DSGVO-first.</div>
      <div id="status" class="status"></div>
      <div id="result" class="result"></div>
    </section>

    <p class="disclaimer">Unterhaltung & achtsame Selbstreflexion. Keine medizinische, rechtliche oder finanzielle Beratung.
    Bei Krisen oder akuter Gefahr: 112 (EU) / lokale Beratungsstellen.</p>
  </main>

  <script type="text/babel" data-presets="react" src="components/horoskop.cdn.jsx"></script>
  <script type="text/babel">
    const mixerRoot = ReactDOM.createRoot(document.getElementById('mixer-root'));
    mixerRoot.render(<KosmischerMixer />);
    window.__mixerState = { mode: 'coach', timeframe: 'week', weights: { astro: 34, num: 13, tarot: 17, iching: 14, cn: 11, tree: 11 } };
    window.addEventListener('horoskop:mixer', (e)=>{ window.__mixerState = e.detail; });

    const mixer = document.getElementById('mixerSection'); const tbtn = document.getElementById('toggle-mixer');
    tbtn.onclick = ()=>{ mixer.style.display = mixer.style.display === 'none' ? 'block':'none'; tbtn.textContent = mixer.style.display==='none'?'Erweiterte Einstellungen ▾':'Erweiterte Einstellungen ▴'; };
  </script>

  <script>
    // Minimaler Offline-Kurzkompass, damit der Button nicht ins Leere läuft
    function generateAnalysis(){
      const birthDate=document.getElementById('birthDate').value;
      const birthPlace=document.getElementById('birthPlace').value.trim();
      const birthTime=document.getElementById('birthTime').value;
      const approx=document.getElementById('timeApprox').value||'unbekannt';
      const out=document.getElementById('result');
      if(!birthDate||!birthPlace){ out.textContent='Bitte Datum und Ort eingeben.'; return; }
      const timeInfo=birthTime?`Uhrzeit ${birthTime}`:`Zeit ungefähr: ${approx}`;
      out.innerHTML = `<div class="reading-card"><b>Kurzkompass (offline)</b><br>Datum: ${birthDate} · Ort: ${birthPlace} · ${timeInfo}.<br>Für die volle Analyse bitte „Gold-Reading (AI)“ nutzen.</div>`;
    }
  </script>

  <script>
    const RAILWAY_BASE = "https://horoskopone-production.up.railway.app"; // ggf. anpassen

    function renderReadingUI(data){
      const box=document.getElementById('result'); box.innerHTML="";
      const head=document.createElement('div'); head.className='reading-card';
      head.innerHTML=`<div class="meta">Modus: <b>${data?.meta?.mode||'-'}</b> · Zeitraum: <b>${data?.meta?.timeframe||'-'}</b> · Seed: <code>${data?.meta?.seed||'-'}</code> · Ort: <b>${data?.meta?.profile?.place||''}</b> · TZ: <code>${data?.meta?.profile?.timezone||''}</code></div>`;
      box.appendChild(head);

      if(Array.isArray(data.highlights) && data.highlights.length){
        const wrap=document.createElement('div'); wrap.className='reading-card';
        wrap.innerHTML=`<h3 style="margin:0 0 8px 0">Deine 3 Highlights</h3>`;
        data.highlights.slice(0,3).forEach(h=>{
          const row=document.createElement('div'); row.className='hl';
          row.innerHTML=`<b>${h.title||'Highlight'}</b><span>${h.action||''}</span>`;
          const why=document.createElement('div'); why.className='why';
          (h.why||[]).forEach(w=>{ const chip=document.createElement('span'); chip.className='badge'; chip.textContent=w; why.appendChild(chip) });
          row.appendChild(why); wrap.appendChild(row);
        });
        box.appendChild(wrap);
      }

      (data.sections||[]).forEach((s,i)=>{
        const area = s.area && s.area!=='undefined' ? s.area : (["Fokus","Beruf","Liebe","Energie","Soziales"][i%5]);
        const det=document.createElement('details'); det.className='reading'; det.open=true;
        det.innerHTML=`<summary>${area}</summary><div style="padding:0 12px 12px 12px">${s.text||''}${s.action?`<div class='meta'>Aktion: ${s.action}</div>`:''}</div>`;
        const why=document.createElement('div'); why.className='why';
        (s.why||[]).forEach(w=>{ const chip=document.createElement('span'); chip.className='badge'; chip.textContent=w; why.appendChild(chip) });
        det.appendChild(why); box.appendChild(det);
      });

      if(data.ritual?.title){
        const r=document.createElement('div'); r.className='reading-card';
        r.innerHTML = `<h3 style="margin:0 0 8px 0">${data.ritual.title}</h3>
                       <ol style="margin:0 0 0 18px">${(data.ritual.steps||[]).map(x=>`<li>${x}</li>`).join("")}</ol>`;
        box.appendChild(r);
      }
      const foot=document.createElement('div'); foot.className='meta';
      foot.textContent=data.disclaimer||'Unterhaltung & achtsame Selbstreflexion. Keine Beratung.';
      box.appendChild(foot);
    }

    async function generateAiReading(){
      const statusEl=document.getElementById('status'); const resultEl=document.getElementById('result');
      const birthDate=document.getElementById('birthDate').value;
      const birthPlace=document.getElementById('birthPlace').value.trim();
      const birthTime=document.getElementById('birthTime').value; const timeApprox=document.getElementById('timeApprox').value || null;
      const partnerDate=document.getElementById('partnerDate').value||null;
      if(!birthDate || !birthPlace){ resultEl.textContent='Bitte Datum und Ort angeben.'; return; }
      const mixer=window.__mixerState || { mode:'coach', timeframe:'week', weights:{ astro:34,num:13,tarot:17,iching:14,cn:11,tree:11 } };

      const payload={
        mode:mixer.mode, timeframe:mixer.timeframe, weights:mixer.weights,
        inputs:{ date:birthDate, time:birthTime||null, timeApprox, place:birthPlace, partnerDate, goals:[], mood:"neutral", style:"pragmatisch" }
      };

      statusEl.textContent='Berechne Gold-Reading …'; resultEl.innerHTML='';
      try{
        const res=await fetch(RAILWAY_BASE.replace(/\/$/,'')+'/reading',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data=await res.json(); if(data.error) throw new Error(data.error);
        renderReadingUI(data); statusEl.textContent='Fertig ✓';
      }catch(e){ statusEl.textContent=''; resultEl.textContent='Fehler: '+(e?.message||e); }
    }
  </script>
</body>
</html>
